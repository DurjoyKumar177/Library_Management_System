{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
  <div class="card">
    <img
      src="{{ book.image.url }}"
      class="card-img-top"
      alt="{{ book.title }}"
      style="max-height: auto; object-fit: cover"
    />
    <div class="card-body">
      <h2 class="card-title text-info">{{ book.title }}</h2>
      <p class="card-text"><strong>Borrow Price:</strong> BDT {{ book.borrowprice }}</p>
      <p class="card-text"><strong>Category:</strong> {{ book.catagory.name }}</p>
      <p class="card-text"><strong>Quantity:</strong> {{ book.quantity }}</p>
      <p class="card-text"><strong>Description:</strong></p>
      <p>{{ book.description }}</p>
      <br />

      <!-- Show the appropriate button -->
      {% if request.GET.source == "profile" %}
      <form method="POST" action="{% url 'borrow_book' book.id %}">
        {% csrf_token %} {% if book.quantity > 0 %}
        <button class="btn btn-primary btn-lg" type="submit">Borrow Again</button>
        {% else %}
        <button class="btn btn-secondary" disabled>Out of Stock</button>
        {% endif %}
      </form>
      {% else %} 
      {% if request.user.is_authenticated %}
      <form action="{% url 'borrow_book' book.id %}" method="POST">
        {% csrf_token %} {% if book.quantity > 0 %}
        <button class="btn btn-success">Borrow Now</button>
        {% else %}
        <button class="btn btn-secondary" disabled>Out of Stock</button>
        {% endif %}
      </form>
      {% else %}
      <p class="text-danger">Login to borrow this book.</p>
      {% endif %} 
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
